# 更新 pH_color_map，使其直接存储经过环境光校正后的颜色与pH值的对应关系
# 格式为: (校正后变色部分颜色(HSV)): pH值
# pH_color_map = {
#     (76.225, 85.511, 169.538): 2.12,
#     (69.042, 112.688, 121.125): 10.03,
#     (75.694, 110.507, 107.013): 10.03,
#     (64.225, 141.675, 165.046): 6.48,
#     (66.572, 147.771, 174.159): 6.48,
#     (100.243, 87.704, 78.796): 11.50,
#     (86.005, 72.789, 61.927): 11.50,
#     (59.702, 138.419, 170.553): 7.68,
#     (76.299, 128.796, 149.702): 7.68,
#     (74.466, 125.422, 138.294): 10.49,
#     (82.934, 113.96, 110.393): 10.49,
#     (79.478, 71.215, 160.221): 0.05,
#     (71.657, 67.065, 135.017): 0.43,
#     (40.758, 191.96, 246.058): 0.43,
#     (83.182, 53.931, 57.818): 13.50,
#     (62.496, 38.833, 43.238): 13.50,
#     (72.414, 67.093, 149.695): 1.52,
#     (62.687, 106.389, 165.138): 2.56,
#     (72.31, 71.215, 169.093): 0.62,
#     (41.211, 142.052, 186.479): 4.02,
#     (70.647, 109.995, 142.279): 3.49,
#     (48.997, 140.586, 177.432): 3.49,
#     (42.001, 141.992, 215.159): 3.01,
#     (59.518, 52.297, 57.753): 9.56,
#     (63.01, 134.845, 141.587): 9.56,
#     (77.233, 66.425, 136.079): 1.08,
#     (62.496, 87.903, 80.765): 8.75,
#     (37.124, 150.306, 205.885): 3.51,
#     (57.527, 59.618, 52.368): 9.73,
#     (53.656, 38.655, 39.311): 12.29,
#     (35.324, 22.461, 25.115): 12.29,
#     (82.001, 103.319, 99.128): 10.97,
#     (63.583, 94.45, 97.072): 10.97,
#     (64.829, 83.136, 72.594): 9.01,
#     (64.996, 56.481, 64.567): 6.27,
#     (58.005, 46.044, 47.841): 10.58,
#     (75.694, 46.862, 47.212): 12.54,
#     (58.714, 37.919, 40.263): 12.54,
#     (73.002, 48.984, 50.359): 13.00,
#     (49.632, 30.868, 34.652): 13.00,
#     (61.578, 41.659, 40.869): 12.01,
#     (67.93, 43.649, 41.159): 12.01,
#     (53.609, 35.028, 38.813): 13.88,
#     (46.964, 31.235, 37.643): 13.88,
# }

# 更新后的pH_color_map，颜色值为经过环境光校正后的HSV颜色值 (H, S, V)
import cv2
import numpy as np


pH_color_map = {
    (14.336, 0.526, 0.664): 2.12,
    (50.029, 0.457, 0.477): 10.03,
    (62.212, 0.386, 0.428): 10.03,
    (47.055, 0.561, 0.649): 6.48,
    (45.838, 0.578, 0.681): 6.48,
    (96.425, 0.103, 0.336): 11.50,
    (110.901, 0.114, 0.28): 11.50,
    (44.516, 0.433, 1.0): 7.68,
    (41.714, 0.5, 0.59): 7.68,
    (48.11, 0.48, 0.543): 10.49,
    (61.325, 0.359, 0.438): 10.49,
    (359.015, 0.514, 0.63): 0.05,
    (356.686, 0.501, 0.531): 0.43,
    (52.087, 0.194, 0.734): 0.43,
    (251.307, 0.249, 0.291): 13.50,
    (263.951, 0.203, 0.198): 13.50,
    (7.16, 0.51, 0.585): 1.52,
    (27.707, 0.571, 0.645): 2.56,
    (359.624, 0.568, 0.662): 0.62,
    (38.787, 0.153, 0.959): 4.02,
    (36.425, 0.508, 0.56): 3.49,
    (36.965, 0.456, 0.536): 3.49,
    (34.856, 1.0, 0.844): 3.01,
    (34.727, 1.0, 0.753): 3.01,
    (29.44, 0.16, 0.228): 9.56,
    (55.532, 0.536, 0.558): 9.56,
    (1.079, 0.461, 0.533): 1.08,
    (72.02, 0.271, 0.335): 8.75,
    (38.163, 0.106, 0.872): 3.51,
    (185.462, 0.221, 0.254): 9.73,
    (43.643, 1.0, 0.692): 6.99,
    (267.393, 0.121, 0.171): 12.29,
    (280.988, 0.141, 0.108): 12.29,
    (68.82, 0.261, 0.407): 10.97,
    (53.458, 0.359, 0.382): 10.97,
    (90.998, 0.201, 0.318): 9.01,
    (3.366, 0.128, 0.256): 6.27,
    (237.151, 0.306, 0.261): 10.58,
    (249.813, 0.175, 0.229): 12.54,
    (267.241, 0.13, 0.174): 12.54,
    (253.092, 0.165, 0.236): 13.00,
    (271.909, 0.152, 0.15): 13.00,
    (245.614, 0.09, 0.181): 12.01,
    (234.157, 0.172, 0.204): 12.01,
    (260.672, 0.253, 0.19): 13.88,
    (274.509, 0.241, 0.167): 13.88,
}
# import cv2
# import numpy as np


def bgr_to_hsv(bgr_tuple):
    """将BGR颜色元组转换为HSV颜色元组（保留3位小数）"""
    # 归一化BGR值到[0,1]范围
    bgr_normalized = np.array([[bgr_tuple]], dtype=np.float32) / 255.0

    # 转换为HSV（OpenCV返回H:[0,180], S:[0,1], V:[0,1]）
    hsv = cv2.cvtColor(bgr_normalized, cv2.COLOR_BGR2HSV)[0][0]

    # 调整Hue范围到[0,360]，Saturation和Value保持[0,1]
    h = float(hsv[0] * 2)  # 将[0,180]转换为[0,360]
    s = float(hsv[1])
    v = float(hsv[2])

    # 四舍五入到3位小数
    return (round(h, 3), round(s, 3), round(v, 3))


# 原始pH_color_map（从上下文获取）
# pH_color_map = {
#     (76.225, 85.511, 169.538): 2.12,
#     (69.042, 112.688, 121.125): 10.03,
#     (75.694, 110.507, 107.013): 10.03,
#     (64.225, 141.675, 165.046): 6.48,
#     (66.572, 147.771, 174.159): 6.48,
#     (100.243, 87.704, 78.796): 11.50,
#     (86.005, 72.789, 61.927): 11.50,
#     (59.702, 138.419, 170.553): 7.68,
#     (76.299, 128.796, 149.702): 7.68,
#     (74.466, 125.422, 138.294): 10.49,
#     (82.934, 113.96, 110.393): 10.49,
#     (79.478, 71.215, 160.221): 0.05,
#     (71.657, 67.065, 135.017): 0.43,
#     (40.758, 191.96, 246.058): 0.43,
#     (83.182, 53.931, 57.818): 13.50,
#     (62.496, 38.833, 43.238): 13.50,
#     (72.414, 67.093, 149.695): 1.52,
#     (62.687, 106.389, 165.138): 2.56,
#     (72.31, 71.215, 169.093): 0.62,
#     (41.211, 142.052, 186.479): 4.02,
#     (70.647, 109.995, 142.279): 3.49,
#     (48.997, 140.586, 177.432): 3.49,
#     (42.001, 141.992, 215.159): 3.01,
#     (59.518, 52.297, 57.753): 9.56,
#     (63.01, 134.845, 141.587): 9.56,
#     (77.233, 66.425, 136.079): 1.08,
#     (62.496, 87.903, 80.765): 8.75,
#     (37.124, 150.306, 205.885): 3.51,
#     (57.527, 59.618, 52.368): 9.73,
#     (53.656, 38.655, 39.311): 12.29,
#     (35.324, 22.461, 25.115): 12.29,
#     (82.001, 103.319, 99.128): 10.97,
#     (63.583, 94.45, 97.072): 10.97,
#     (64.829, 83.136, 72.594): 9.01,
#     (64.996, 56.481, 64.567): 6.27,
#     (58.005, 46.044, 47.841): 10.58,
#     (75.694, 46.862, 47.212): 12.54,
#     (58.714, 37.919, 40.263): 12.54,
#     (73.002, 48.984, 50.359): 13.00,
#     (49.632, 30.868, 34.652): 13.00,
#     (61.578, 41.659, 40.869): 12.01,
#     (67.93, 43.649, 41.159): 12.01,
#     (53.609, 35.028, 38.813): 13.88,
#     (46.964, 31.235, 37.643): 13.88,
# }

# # 转换所有颜色
# hsv_color_map = {}
# for bgr, ph in pH_color_map.items():
#     hsv = bgr_to_hsv(bgr)
#     hsv_color_map[hsv] = ph

# # 生成可替换的字符串
# output = "pH_color_map = {\n"
# for hsv, ph in hsv_color_map.items():
#     h, s, v = hsv
#     output += f"    ({h:.3f}, {s:.3f}, {v:.3f}): {ph},\n"
# output += "}"

# print("转换完成！以下是可直接替换的代码：")
# print("=" * 50)

# 双颜色pH映射（变色颜色 + 未变色颜色）
# 未变色颜色固定为 (42.0, 0.71, 0.82)
UNCOLORED_HSV = (42.0, 0.71, 0.82)

pH_color_map_two_colors = {
    (355.334, 0.626, 0.569, 43.847, 0.657, 0.722): 0.05,
    (355.163, 0.552, 0.514, 44.202, 0.62, 0.86): 0.43,
    (50.386, 0.786, 0.651, 50.384, 0.781, 0.68): 0.43,
    (356.769, 0.604, 0.542, 41.674, 0.642, 0.726): 0.62,
    (0.224, 0.581, 0.466, 37.506, 0.663, 0.641): 1.08,
    (4.96, 0.669, 0.495, 43.245, 0.685, 0.719): 1.52,
    (49.826, 0.636, 0.463, 44.101, 0.687, 0.732): 10.03,
    (69.663, 0.506, 0.272, 52.831, 0.652, 0.465): 10.03,
    (49.218, 0.61, 0.533, 44.174, 0.654, 0.8): 10.49,
    (60.914, 0.503, 0.426, 44.828, 0.678, 0.764): 10.49,
    (237.968, 0.255, 0.209, 50.427, 0.502, 0.67): 10.58,
    (89.703, 0.226, 0.352, 45.221, 0.651, 0.783): 10.97,
    (59.474, 0.348, 0.318, 44.671, 0.627, 0.773): 10.97,
    (114.351, 0.102, 0.333, 44.874, 0.656, 0.8): 11.50,
    (109.359, 0.159, 0.272, 46.134, 0.684, 0.798): 11.50,
    (244.381, 0.138, 0.183, 45.838, 0.669, 0.83): 12.01,
    (232.8, 0.246, 0.208, 45.092, 0.65, 0.845): 12.01,
    (246.945, 0.205, 0.151, 43.772, 0.625, 0.821): 12.29,
    (302.423, 0.138, 0.09, 45.057, 0.665, 0.81): 12.29,
    (253.839, 0.24, 0.225, 44.565, 0.641, 0.827): 12.54,
    (265.225, 0.171, 0.162, 45.787, 0.669, 0.819): 12.54,
    (246.823, 0.218, 0.255, 45.71, 0.616, 0.906): 13.00,
    (274.569, 0.2, 0.156, 45.973, 0.656, 0.856): 13.00,
    (252.504, 0.29, 0.309, 45.082, 0.622, 0.86): 13.50,
    (269.183, 0.242, 0.195, 45.283, 0.648, 0.824): 13.50,
    (254.889, 0.303, 0.199, 43.832, 0.615, 0.808): 13.88,
    (273.49, 0.309, 0.16, 45.467, 0.637, 0.829): 13.88,
    (12.637, 0.709, 0.583, 42.122, 0.708, 0.715): 2.12,
    (28.379, 0.731, 0.633, 42.916, 0.647, 0.781): 2.56,
    (31.382, 0.676, 0.728, 42.202, 0.654, 0.79): 3.01,
    (32.05, 0.778, 0.781, 33.418, 0.78, 0.828): 3.01,
    (43.823, 0.669, 0.73, 43.396, 0.735, 0.642): 3.49,
    (45.163, 0.651, 0.776, 44.267, 0.751, 0.676): 3.49,
    (45.898, 0.612, 0.736, 42.353, 0.732, 0.713): 3.51,
    (44.9, 0.612, 0.781, 43.963, 0.676, 0.673): 4.02,
    (44.245, 0.614, 0.752, 44.01, 0.726, 0.661): 6.27,
    (47.525, 0.764, 0.635, 45.872, 0.702, 0.797): 6.48,
    (46.036, 0.724, 0.68, 44.822, 0.665, 0.816): 6.48,
    (45.791, 0.706, 0.553, 43.583, 0.622, 0.585): 6.99,
    (44.623, 0.747, 0.652, 43.795, 0.663, 0.781): 7.68,
    (41.315, 0.772, 0.727, 42.78, 0.77, 0.559): 7.68,
    (74.06, 0.299, 0.268, 41.814, 0.612, 0.625): 8.75,
    (88.958, 0.25, 0.266, 44.616, 0.619, 0.693): 9.01,
    (47.938, 0.691, 0.69, 44.659, 0.626, 0.81): 9.56,
    (56.621, 0.664, 0.544, 46.627, 0.665, 0.786): 9.56,
    (180.744, 0.184, 0.216, 50.53, 0.567, 0.749): 9.73,
}
# for colored_hsv, ph in pH_color_map.items():
#     key = (*colored_hsv, *UNCOLORED_HSV)  # 拼接两个元组
#     pH_color_map_two_colors[key] = ph

# 可选：打印新映射的大小
# print(f"双颜色映射条目数: {len(pH_color_map_two_colors)}")
# print(output)
# print("=" * 50)
