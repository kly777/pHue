# 更新 pH_color_map，使其直接存储经过环境光校正后的颜色与pH值的对应关系
# 格式为: (校正后变色部分颜色(HSV)): pH值
# pH_color_map = {
#     (76.225, 85.511, 169.538): 2.12,
#     (69.042, 112.688, 121.125): 10.03,
#     (75.694, 110.507, 107.013): 10.03,
#     (64.225, 141.675, 165.046): 6.48,
#     (66.572, 147.771, 174.159): 6.48,
#     (100.243, 87.704, 78.796): 11.50,
#     (86.005, 72.789, 61.927): 11.50,
#     (59.702, 138.419, 170.553): 7.68,
#     (76.299, 128.796, 149.702): 7.68,
#     (74.466, 125.422, 138.294): 10.49,
#     (82.934, 113.96, 110.393): 10.49,
#     (79.478, 71.215, 160.221): 0.05,
#     (71.657, 67.065, 135.017): 0.43,
#     (40.758, 191.96, 246.058): 0.43,
#     (83.182, 53.931, 57.818): 13.50,
#     (62.496, 38.833, 43.238): 13.50,
#     (72.414, 67.093, 149.695): 1.52,
#     (62.687, 106.389, 165.138): 2.56,
#     (72.31, 71.215, 169.093): 0.62,
#     (41.211, 142.052, 186.479): 4.02,
#     (70.647, 109.995, 142.279): 3.49,
#     (48.997, 140.586, 177.432): 3.49,
#     (42.001, 141.992, 215.159): 3.01,
#     (59.518, 52.297, 57.753): 9.56,
#     (63.01, 134.845, 141.587): 9.56,
#     (77.233, 66.425, 136.079): 1.08,
#     (62.496, 87.903, 80.765): 8.75,
#     (37.124, 150.306, 205.885): 3.51,
#     (57.527, 59.618, 52.368): 9.73,
#     (53.656, 38.655, 39.311): 12.29,
#     (35.324, 22.461, 25.115): 12.29,
#     (82.001, 103.319, 99.128): 10.97,
#     (63.583, 94.45, 97.072): 10.97,
#     (64.829, 83.136, 72.594): 9.01,
#     (64.996, 56.481, 64.567): 6.27,
#     (58.005, 46.044, 47.841): 10.58,
#     (75.694, 46.862, 47.212): 12.54,
#     (58.714, 37.919, 40.263): 12.54,
#     (73.002, 48.984, 50.359): 13.00,
#     (49.632, 30.868, 34.652): 13.00,
#     (61.578, 41.659, 40.869): 12.01,
#     (67.93, 43.649, 41.159): 12.01,
#     (53.609, 35.028, 38.813): 13.88,
#     (46.964, 31.235, 37.643): 13.88,
# }

# 更新后的pH_color_map，颜色值为经过环境光校正后的HSV颜色值 (H, S, V)
import cv2
import numpy as np


pH_color_map = {
    (14.336, 0.526, 0.664): 2.12,
    (50.029, 0.457, 0.477): 10.03,
    (62.212, 0.386, 0.428): 10.03,
    (47.055, 0.561, 0.649): 6.48,
    (45.838, 0.578, 0.681): 6.48,
    (96.425, 0.103, 0.336): 11.50,
    (110.901, 0.114, 0.28): 11.50,
    (44.516, 0.433, 1.0): 7.68,
    (41.714, 0.5, 0.59): 7.68,
    (48.11, 0.48, 0.543): 10.49,
    (61.325, 0.359, 0.438): 10.49,
    (359.015, 0.514, 0.63): 0.05,
    (356.686, 0.501, 0.531): 0.43,
    (52.087, 0.194, 0.734): 0.43,
    (251.307, 0.249, 0.291): 13.50,
    (263.951, 0.203, 0.198): 13.50,
    (7.16, 0.51, 0.585): 1.52,
    (27.707, 0.571, 0.645): 2.56,
    (359.624, 0.568, 0.662): 0.62,
    (38.787, 0.153, 0.959): 4.02,
    (36.425, 0.508, 0.56): 3.49,
    (36.965, 0.456, 0.536): 3.49,
    (34.856, 1.0, 0.844): 3.01,
    (34.727, 1.0, 0.753): 3.01,
    (29.44, 0.16, 0.228): 9.56,
    (55.532, 0.536, 0.558): 9.56,
    (1.079, 0.461, 0.533): 1.08,
    (72.02, 0.271, 0.335): 8.75,
    (38.163, 0.106, 0.872): 3.51,
    (185.462, 0.221, 0.254): 9.73,
    (43.643, 1.0, 0.692): 6.99,
    (267.393, 0.121, 0.171): 12.29,
    (280.988, 0.141, 0.108): 12.29,
    (68.82, 0.261, 0.407): 10.97,
    (53.458, 0.359, 0.382): 10.97,
    (90.998, 0.201, 0.318): 9.01,
    (3.366, 0.128, 0.256): 6.27,
    (237.151, 0.306, 0.261): 10.58,
    (249.813, 0.175, 0.229): 12.54,
    (267.241, 0.13, 0.174): 12.54,
    (253.092, 0.165, 0.236): 13.00,
    (271.909, 0.152, 0.15): 13.00,
    (245.614, 0.09, 0.181): 12.01,
    (234.157, 0.172, 0.204): 12.01,
    (260.672, 0.253, 0.19): 13.88,
    (274.509, 0.241, 0.167): 13.88,
}
# import cv2
# import numpy as np


def bgr_to_hsv(bgr_tuple):
    """将BGR颜色元组转换为HSV颜色元组（保留3位小数）"""
    # 归一化BGR值到[0,1]范围
    bgr_normalized = np.array([[bgr_tuple]], dtype=np.float32) / 255.0

    # 转换为HSV（OpenCV返回H:[0,180], S:[0,1], V:[0,1]）
    hsv = cv2.cvtColor(bgr_normalized, cv2.COLOR_BGR2HSV)[0][0]

    # 调整Hue范围到[0,360]，Saturation和Value保持[0,1]
    h = float(hsv[0] * 2)  # 将[0,180]转换为[0,360]
    s = float(hsv[1])
    v = float(hsv[2])

    # 四舍五入到3位小数
    return (round(h, 3), round(s, 3), round(v, 3))


# 原始pH_color_map（从上下文获取）
# pH_color_map = {
#     (76.225, 85.511, 169.538): 2.12,
#     (69.042, 112.688, 121.125): 10.03,
#     (75.694, 110.507, 107.013): 10.03,
#     (64.225, 141.675, 165.046): 6.48,
#     (66.572, 147.771, 174.159): 6.48,
#     (100.243, 87.704, 78.796): 11.50,
#     (86.005, 72.789, 61.927): 11.50,
#     (59.702, 138.419, 170.553): 7.68,
#     (76.299, 128.796, 149.702): 7.68,
#     (74.466, 125.422, 138.294): 10.49,
#     (82.934, 113.96, 110.393): 10.49,
#     (79.478, 71.215, 160.221): 0.05,
#     (71.657, 67.065, 135.017): 0.43,
#     (40.758, 191.96, 246.058): 0.43,
#     (83.182, 53.931, 57.818): 13.50,
#     (62.496, 38.833, 43.238): 13.50,
#     (72.414, 67.093, 149.695): 1.52,
#     (62.687, 106.389, 165.138): 2.56,
#     (72.31, 71.215, 169.093): 0.62,
#     (41.211, 142.052, 186.479): 4.02,
#     (70.647, 109.995, 142.279): 3.49,
#     (48.997, 140.586, 177.432): 3.49,
#     (42.001, 141.992, 215.159): 3.01,
#     (59.518, 52.297, 57.753): 9.56,
#     (63.01, 134.845, 141.587): 9.56,
#     (77.233, 66.425, 136.079): 1.08,
#     (62.496, 87.903, 80.765): 8.75,
#     (37.124, 150.306, 205.885): 3.51,
#     (57.527, 59.618, 52.368): 9.73,
#     (53.656, 38.655, 39.311): 12.29,
#     (35.324, 22.461, 25.115): 12.29,
#     (82.001, 103.319, 99.128): 10.97,
#     (63.583, 94.45, 97.072): 10.97,
#     (64.829, 83.136, 72.594): 9.01,
#     (64.996, 56.481, 64.567): 6.27,
#     (58.005, 46.044, 47.841): 10.58,
#     (75.694, 46.862, 47.212): 12.54,
#     (58.714, 37.919, 40.263): 12.54,
#     (73.002, 48.984, 50.359): 13.00,
#     (49.632, 30.868, 34.652): 13.00,
#     (61.578, 41.659, 40.869): 12.01,
#     (67.93, 43.649, 41.159): 12.01,
#     (53.609, 35.028, 38.813): 13.88,
#     (46.964, 31.235, 37.643): 13.88,
# }

# # 转换所有颜色
# hsv_color_map = {}
# for bgr, ph in pH_color_map.items():
#     hsv = bgr_to_hsv(bgr)
#     hsv_color_map[hsv] = ph

# # 生成可替换的字符串
# output = "pH_color_map = {\n"
# for hsv, ph in hsv_color_map.items():
#     h, s, v = hsv
#     output += f"    ({h:.3f}, {s:.3f}, {v:.3f}): {ph},\n"
# output += "}"

# print("转换完成！以下是可直接替换的代码：")
# print("=" * 50)

# 双颜色pH映射（变色颜色 + 未变色颜色）
# 未变色颜色固定为 (42.0, 0.71, 0.82)
UNCOLORED_HSV = (42.0, 0.71, 0.82)

pH_color_map_two_colors = {
    (355.218, 0.628, 0.569, 43.922, 0.657, 0.723): 0.05,
    (355.172, 0.551, 0.516, 44.132, 0.618, 0.861): 0.43,
    (50.443, 0.785, 0.648, 50.399, 0.781, 0.68): 0.43,
    (356.866, 0.604, 0.542, 41.676, 0.642, 0.727): 0.62,
    (0.255, 0.578, 0.47, 37.469, 0.661, 0.642): 1.08,
    (5.455, 0.665, 0.497, 43.327, 0.686, 0.719): 1.52,
    (49.591, 0.639, 0.472, 44.245, 0.688, 0.731): 10.03,
    (69.054, 0.508, 0.276, 53.439, 0.648, 0.456): 10.03,
    (49.216, 0.611, 0.532, 44.162, 0.655, 0.801): 10.49,
    (62.127, 0.497, 0.421, 44.761, 0.676, 0.764): 10.49,
    (237.928, 0.247, 0.213, 50.423, 0.495, 0.675): 10.58,
    (87.995, 0.236, 0.355, 45.126, 0.655, 0.784): 10.97,
    (59.273, 0.347, 0.315, 44.562, 0.629, 0.772): 10.97,
    (106.214, 0.117, 0.336, 44.91, 0.658, 0.796): 11.50,
    (101.547, 0.18, 0.282, 46.147, 0.684, 0.798): 11.50,
    (246.895, 0.142, 0.182, 45.785, 0.669, 0.826): 12.01,
    (231.948, 0.222, 0.209, 45.041, 0.65, 0.848): 12.01,
    (247.787, 0.213, 0.151, 43.74, 0.624, 0.82): 12.29,
    (290.26, 0.163, 0.091, 45.045, 0.663, 0.81): 12.29,
    (252.707, 0.24, 0.225, 44.531, 0.641, 0.825): 12.54,
    (264.693, 0.189, 0.164, 45.892, 0.669, 0.815): 12.54,
    (246.544, 0.217, 0.253, 45.85, 0.617, 0.9): 13.00,
    (276.732, 0.198, 0.158, 45.895, 0.656, 0.855): 13.00,
    (252.119, 0.283, 0.307, 45.066, 0.62, 0.862): 13.50,
    (269.397, 0.248, 0.195, 45.193, 0.646, 0.822): 13.50,
    (255.947, 0.298, 0.197, 43.86, 0.617, 0.807): 13.88,
    (274.123, 0.303, 0.162, 45.508, 0.638, 0.829): 13.88,
    (12.486, 0.712, 0.582, 42.393, 0.707, 0.716): 2.12,
    (28.012, 0.731, 0.63, 42.944, 0.649, 0.781): 2.56,
    (31.553, 0.675, 0.727, 42.308, 0.652, 0.791): 3.01,
    (31.938, 0.779, 0.782, 33.252, 0.781, 0.829): 3.01,
    (43.891, 0.67, 0.73, 43.295, 0.734, 0.641): 3.49,
    (45.17, 0.642, 0.782, 44.321, 0.749, 0.677): 3.49,
    (45.889, 0.612, 0.736, 42.305, 0.735, 0.717): 3.51,
    (44.791, 0.611, 0.781, 43.988, 0.676, 0.674): 4.02,
    (44.841, 0.712, 0.582, 44.483, 0.613, 0.621): 4.26,
    (46.322, 0.638, 0.568, 44.853, 0.604, 0.523): 4.76,
    (45.357, 0.625, 0.515, 44.957, 0.575, 0.582): 5.00,
    (45.636, 0.689, 0.633, 45.054, 0.594, 0.708): 5.26,
    (45.18, 0.706, 0.577, 44.575, 0.612, 0.66): 5.53,
    (44.814, 0.712, 0.646, 44.717, 0.619, 0.708): 5.77,
    (44.21, 0.615, 0.751, 43.988, 0.726, 0.661): 6.27,
    (47.535, 0.766, 0.634, 45.892, 0.702, 0.798): 6.48,
    (46.02, 0.724, 0.68, 44.829, 0.665, 0.816): 6.48,
    (45.416, 0.518, 0.682, 45.247, 0.604, 0.597): 6.50,
    (45.796, 0.706, 0.553, 43.504, 0.62, 0.584): 6.99,
    (47.794, 0.643, 0.479, 44.265, 0.599, 0.62): 7.50,
    (44.542, 0.747, 0.649, 43.844, 0.665, 0.779): 7.68,
    (41.274, 0.769, 0.731, 42.859, 0.768, 0.56): 7.68,
    (51.111, 0.642, 0.456, 44.759, 0.616, 0.614): 7.74,
    (74.455, 0.299, 0.265, 41.809, 0.612, 0.626): 8.75,
    (87.797, 0.251, 0.267, 44.621, 0.619, 0.695): 9.01,
    (152.363, 0.121, 0.259, 44.706, 0.553, 0.69): 9.50,
    (106.051, 0.159, 0.325, 45.515, 0.545, 0.697): 9.51,
    (47.646, 0.692, 0.69, 44.679, 0.625, 0.811): 9.56,
    (56.351, 0.666, 0.548, 46.654, 0.664, 0.785): 9.56,
    (179.23, 0.179, 0.218, 50.548, 0.569, 0.753): 9.73,
}
# for colored_hsv, ph in pH_color_map.items():
#     key = (*colored_hsv, *UNCOLORED_HSV)  # 拼接两个元组
#     pH_color_map_two_colors[key] = ph

# 可选：打印新映射的大小
# print(f"双颜色映射条目数: {len(pH_color_map_two_colors)}")
# print(output)
# print("=" * 50)
