# 更新 pH_color_map，使其直接存储经过环境光校正后的颜色与pH值的对应关系
# 格式为: (校正后变色部分颜色(HSV)): pH值
# pH_color_map = {
#     (76.225, 85.511, 169.538): 2.12,
#     (69.042, 112.688, 121.125): 10.03,
#     (75.694, 110.507, 107.013): 10.03,
#     (64.225, 141.675, 165.046): 6.48,
#     (66.572, 147.771, 174.159): 6.48,
#     (100.243, 87.704, 78.796): 11.50,
#     (86.005, 72.789, 61.927): 11.50,
#     (59.702, 138.419, 170.553): 7.68,
#     (76.299, 128.796, 149.702): 7.68,
#     (74.466, 125.422, 138.294): 10.49,
#     (82.934, 113.96, 110.393): 10.49,
#     (79.478, 71.215, 160.221): 0.05,
#     (71.657, 67.065, 135.017): 0.43,
#     (40.758, 191.96, 246.058): 0.43,
#     (83.182, 53.931, 57.818): 13.50,
#     (62.496, 38.833, 43.238): 13.50,
#     (72.414, 67.093, 149.695): 1.52,
#     (62.687, 106.389, 165.138): 2.56,
#     (72.31, 71.215, 169.093): 0.62,
#     (41.211, 142.052, 186.479): 4.02,
#     (70.647, 109.995, 142.279): 3.49,
#     (48.997, 140.586, 177.432): 3.49,
#     (42.001, 141.992, 215.159): 3.01,
#     (59.518, 52.297, 57.753): 9.56,
#     (63.01, 134.845, 141.587): 9.56,
#     (77.233, 66.425, 136.079): 1.08,
#     (62.496, 87.903, 80.765): 8.75,
#     (37.124, 150.306, 205.885): 3.51,
#     (57.527, 59.618, 52.368): 9.73,
#     (53.656, 38.655, 39.311): 12.29,
#     (35.324, 22.461, 25.115): 12.29,
#     (82.001, 103.319, 99.128): 10.97,
#     (63.583, 94.45, 97.072): 10.97,
#     (64.829, 83.136, 72.594): 9.01,
#     (64.996, 56.481, 64.567): 6.27,
#     (58.005, 46.044, 47.841): 10.58,
#     (75.694, 46.862, 47.212): 12.54,
#     (58.714, 37.919, 40.263): 12.54,
#     (73.002, 48.984, 50.359): 13.00,
#     (49.632, 30.868, 34.652): 13.00,
#     (61.578, 41.659, 40.869): 12.01,
#     (67.93, 43.649, 41.159): 12.01,
#     (53.609, 35.028, 38.813): 13.88,
#     (46.964, 31.235, 37.643): 13.88,
# }

# 更新后的pH_color_map，颜色值为经过环境光校正后的HSV颜色值 (H, S, V)
import cv2
import numpy as np


pH_color_map = {
    (11.942, 0.550, 0.665): 2.12,
    (100.561, 0.430, 0.475): 10.03,
    (132.044, 0.315, 0.433): 10.03,
    (92.183, 0.611, 0.647): 6.48,
    (90.567, 0.618, 0.683): 6.48,
    (430.158, 0.214, 0.393): 11.5,
    (425.866, 0.280, 0.337): 11.5,
    (85.214, 0.650, 0.669): 7.68,
    (85.823, 0.490, 0.587): 7.68,
    (95.800, 0.462, 0.542): 10.49,
    (133.796, 0.272, 0.447): 10.49,
    (708.860, 0.556, 0.628): 0.05,
    (711.891, 0.503, 0.529): 0.43,
    (88.379, 0.834, 0.965): 0.43,
    (495.946, 0.352, 0.326): 13.5,
    (502.339, 0.379, 0.245): 13.5,
    (712.270, 0.552, 0.587): 1.52,
    (51.188, 0.620, 0.648): 2.56,
    (718.658, 0.579, 0.663): 0.62,
    (83.301, 0.779, 0.731): 4.02,
    (65.917, 0.503, 0.558): 3.49,
    (85.574, 0.724, 0.696): 3.49,
    (69.295, 0.805, 0.844): 3.01,
    (570.668, 0.121, 0.233): 9.56,
    (109.704, 0.555, 0.555): 9.56,
    (701.380, 0.512, 0.534): 1.08,
    (153.714, 0.289, 0.345): 8.75,
    (80.480, 0.820, 0.807): 3.51,
    (325.390, 0.122, 0.234): 9.73,
    (485.248, 0.280, 0.210): 12.29,
    (504.759, 0.364, 0.139): 12.29,
    (143.591, 0.206, 0.405): 10.97,
    (110.605, 0.345, 0.381): 10.97,
    (189.102, 0.220, 0.326): 9.01,
    (593.954, 0.131, 0.255): 6.27,
    (498.029, 0.206, 0.227): 10.58,
    (481.457, 0.381, 0.297): 12.54,
    (493.526, 0.354, 0.230): 12.54,
    (486.870, 0.329, 0.286): 13.0,
    (504.199, 0.378, 0.195): 13.0,
    (475.422, 0.336, 0.241): 12.01,
    (468.839, 0.394, 0.266): 12.01,
    (504.444, 0.347, 0.210): 13.88,
    (528.888, 0.335, 0.184): 13.88,
}
# import cv2
# import numpy as np


def bgr_to_hsv(bgr_tuple):
    """将BGR颜色元组转换为HSV颜色元组（保留3位小数）"""
    # 归一化BGR值到[0,1]范围
    bgr_normalized = np.array([[bgr_tuple]], dtype=np.float32) / 255.0

    # 转换为HSV（OpenCV返回H:[0,180], S:[0,1], V:[0,1]）
    hsv = cv2.cvtColor(bgr_normalized, cv2.COLOR_BGR2HSV)[0][0]

    # 调整Hue范围到[0,360]，Saturation和Value保持[0,1]
    h = float(hsv[0] * 2)  # 将[0,180]转换为[0,360]
    s = float(hsv[1])
    v = float(hsv[2])

    # 四舍五入到3位小数
    return (round(h, 3), round(s, 3), round(v, 3))


# 原始pH_color_map（从上下文获取）
# pH_color_map = {
#     (76.225, 85.511, 169.538): 2.12,
#     (69.042, 112.688, 121.125): 10.03,
#     (75.694, 110.507, 107.013): 10.03,
#     (64.225, 141.675, 165.046): 6.48,
#     (66.572, 147.771, 174.159): 6.48,
#     (100.243, 87.704, 78.796): 11.50,
#     (86.005, 72.789, 61.927): 11.50,
#     (59.702, 138.419, 170.553): 7.68,
#     (76.299, 128.796, 149.702): 7.68,
#     (74.466, 125.422, 138.294): 10.49,
#     (82.934, 113.96, 110.393): 10.49,
#     (79.478, 71.215, 160.221): 0.05,
#     (71.657, 67.065, 135.017): 0.43,
#     (40.758, 191.96, 246.058): 0.43,
#     (83.182, 53.931, 57.818): 13.50,
#     (62.496, 38.833, 43.238): 13.50,
#     (72.414, 67.093, 149.695): 1.52,
#     (62.687, 106.389, 165.138): 2.56,
#     (72.31, 71.215, 169.093): 0.62,
#     (41.211, 142.052, 186.479): 4.02,
#     (70.647, 109.995, 142.279): 3.49,
#     (48.997, 140.586, 177.432): 3.49,
#     (42.001, 141.992, 215.159): 3.01,
#     (59.518, 52.297, 57.753): 9.56,
#     (63.01, 134.845, 141.587): 9.56,
#     (77.233, 66.425, 136.079): 1.08,
#     (62.496, 87.903, 80.765): 8.75,
#     (37.124, 150.306, 205.885): 3.51,
#     (57.527, 59.618, 52.368): 9.73,
#     (53.656, 38.655, 39.311): 12.29,
#     (35.324, 22.461, 25.115): 12.29,
#     (82.001, 103.319, 99.128): 10.97,
#     (63.583, 94.45, 97.072): 10.97,
#     (64.829, 83.136, 72.594): 9.01,
#     (64.996, 56.481, 64.567): 6.27,
#     (58.005, 46.044, 47.841): 10.58,
#     (75.694, 46.862, 47.212): 12.54,
#     (58.714, 37.919, 40.263): 12.54,
#     (73.002, 48.984, 50.359): 13.00,
#     (49.632, 30.868, 34.652): 13.00,
#     (61.578, 41.659, 40.869): 12.01,
#     (67.93, 43.649, 41.159): 12.01,
#     (53.609, 35.028, 38.813): 13.88,
#     (46.964, 31.235, 37.643): 13.88,
# }

# # 转换所有颜色
# hsv_color_map = {}
# for bgr, ph in pH_color_map.items():
#     hsv = bgr_to_hsv(bgr)
#     hsv_color_map[hsv] = ph

# # 生成可替换的字符串
# output = "pH_color_map = {\n"
# for hsv, ph in hsv_color_map.items():
#     h, s, v = hsv
#     output += f"    ({h:.3f}, {s:.3f}, {v:.3f}): {ph},\n"
# output += "}"

# print("转换完成！以下是可直接替换的代码：")
# print("=" * 50)
# print(output)
# print("=" * 50)
